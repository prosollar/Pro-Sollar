<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-Sollar | Intelig√™ncia Energ√©tica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700;800&display=swap');
        :root { --bg-deep: #0a1120; --accent-blue: #3b82f6; --accent-yellow: #facc15; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            color: white;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 10% 80%, rgba(250, 204, 21, 0.05) 0%, transparent 30%);
            background-attachment: fixed;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .card-glow { position: relative; }
        .card-glow::before {
            content: ""; position: absolute; inset: -1px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.5), transparent, rgba(250, 204, 21, 0.5));
            border-radius: 2.5rem; z-index: -1; opacity: 0.4;
        }
        .input-dark {
            background: rgba(0, 0, 0, 0.4) !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
            color: #fff !important;
            transition: all 0.3s ease;
        }
        .btn-yellow {
            background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
            color: #000; font-weight: 800;
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.3);
            transition: all 0.3s ease;
        }
        .btn-yellow:hover { transform: scale(1.02); box-shadow: 0 0 35px rgba(250, 204, 21, 0.6); }
        .pac-container { background-color: #1e293b !important; border-radius: 1.25rem !important; border: none !important; font-family: inherit !important; }
        .pac-item { color: #cbd5e1 !important; padding: 12px !important; }
        .pac-item-query { color: white !important; }
    </style>
</head>
<body class="overflow-x-hidden">

    <nav class="container mx-auto p-8 flex justify-between items-center relative z-10">
        <div class="flex items-center space-x-3">
            <div class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-600 rounded-xl flex items-center justify-center">
                <i class="fas fa-solar-panel text-white text-2xl"></i>
            </div>
            <span class="text-2xl font-black tracking-tighter uppercase">Pro-<span class="text-blue-500">Sollar</span></span>
        </div>
        <a href="login.html" class="bg-blue-600/20 border border-blue-500/30 px-6 py-2 rounded-full text-sm font-bold hover:bg-blue-600 transition text-white">
            <i class="fas fa-user-circle mr-2"></i> √Årea do Cliente
        </a>
    </nav>

    <main class="container mx-auto px-6 py-12 grid lg:grid-cols-2 gap-16 items-center">
        <div class="space-y-8">
            <h1 class="text-6xl lg:text-7xl font-extrabold leading-[1.1]">
                Economia que vem do <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">C√©u.</span>
            </h1>
            <p class="text-slate-400 text-xl max-w-lg">An√°lise inteligente via sat√©lite para entregar sua independ√™ncia energ√©tica em segundos.</p>
        </div>

        <div class="card-glow">
            <div class="glass-card p-10 space-y-6">
                <h2 class="text-2xl font-bold">Simule Seu Potencial</h2>
                <form id="simuladorForm" class="space-y-4">
                    <input type="text" id="endereco" placeholder="Endere√ßo da Instala√ß√£o" class="input-dark w-full px-4 py-4 rounded-2xl text-sm">
                    <input type="tel" id="consumo" placeholder="Gasto Mensal (R$)" class="input-dark w-full px-4 py-4 rounded-2xl text-sm" oninput="mascaraMoeda(this)">
                    <input type="email" id="email" placeholder="Seu E-mail" class="input-dark w-full px-4 py-4 rounded-2xl text-sm">
                    <input type="tel" id="whatsapp" placeholder="WhatsApp" class="input-dark w-full px-4 py-4 rounded-2xl text-sm" oninput="mascaraTelefone(this)">
                    
                    <input type="hidden" id="lat"> <input type="hidden" id="lng">

                    <button type="button" id="btnGerar" class="btn-yellow w-full py-5 rounded-2xl uppercase text-[11px] font-black">
                        Gerar Proposta Instant√¢nea <i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </form>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>

    <script>
        // CONFIGURA√á√ÉO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyCpcQqXdDWtEW2wPsj9Z2dLdt_IzLLKWV8",
            authDomain: "pro-sollar-performance.firebaseapp.com",
            projectId: "pro-sollar-performance",
            storageBucket: "pro-sollar-performance.firebasestorage.app",
            messagingSenderId: "484051034820",
            appId: "1:484051034820:web:3cf21ee3ce55b9c5625f91"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // M√ÅSCARAS
        function mascaraMoeda(i) {
            let v = i.value.replace(/\D/g, '');
            v = (v / 100).toFixed(2) + '';
            v = v.replace(".", ",");
            v = v.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
            i.value = v; 
        }
        function mascaraTelefone(i) {
            let v = i.value.replace(/\D/g, "");
            v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
            v = v.replace(/(\d)(\d{4})$/, "$1-$2");
            i.value = v;
        }

        // ENGENHARIA FINANCEIRA
        function calcularEngenhariaFinanceira(consumoReais) {
            const tarifa = 0.92;
            const irradiacao = 4.8;
            const consumoKwh = consumoReais / tarifa;
            const potenciaKwp = consumoKwh / (irradiacao * 30.4 * 0.75);
            const investimento = (consumoReais * 30) * 0.95; 

            return {
                kwp: potenciaKwp.toFixed(2),
                investimento: investimento.toFixed(2),
                payback: (investimento / (consumoReais * 12)).toFixed(1)
            };
        }

        // ENVIO SENDGRID
        async function dispararEmailSendGrid(dados, emailCliente, zapCliente) {
            const apiKey = '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'; // <--- INSIRA SUA CHAVE AQUI
            
            const corpo = {
                personalizations: [{ to: [{ email: 'contato.prosollar@vmcprojetos.com' }] }],
                from: { email: 'contato.prosollar@vmcprojetos.com' },
                subject: `üöÄ Novo Lead: ${emailCliente}`,
                content: [{
                    type: 'text/html',
                    value: `
                        <h2>Nova Simula√ß√£o Pro-Sollar</h2>
                        <p><b>Cliente:</b> ${emailCliente} | <b>Zap:</b> ${zapCliente}</p>
                        <p><b>Pot√™ncia:</b> ${dados.kwp} kWp</p>
                        <p><b>Investimento Est.:</b> R$ ${parseFloat(dados.investimento).toLocaleString('pt-BR')}</p>
                        <p><b>Payback:</b> ${dados.payback} anos</p>
                    `
                }]
            };

            try {
                await fetch('https://api.sendgrid.com/v3/mail/send', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${apiKey}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify(corpo)
                });
            } catch (e) { console.error("Erro e-mail:", e); }
        }

        // A√á√ÉO PRINCIPAL
        document.getElementById('btnGerar').addEventListener('click', async function() {
            const email = document.getElementById('email').value;
            const zap = document.getElementById('whatsapp').value;
            const endereco = document.getElementById('endereco').value;
            const consumoRaw = document.getElementById('consumo').value;
            const lat = document.getElementById('lat').value;
            const lng = document.getElementById('lng').value;

            if (!email || !zap || !consumoRaw || !lat) {
                alert("Preencha todos os campos e selecione o endere√ßo sugerido.");
                return;
            }

            this.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Processando...';
            this.disabled = true;

            const consumoLimpo = parseFloat(consumoRaw.replace(/\./g, '').replace(',', '.'));
            const calculo = calcularEngenhariaFinanceira(consumoLimpo);

            try {
                // 1. Salva no Firebase
                await db.collection("leads").doc(email).set({
                    email, whatsapp: zap, endereco, consumo: consumoLimpo,
                    coordenadas: { lat, lng },
                    projeto: calculo,
                    criado_em: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });

                // 2. Dispara e-mail via SendGrid
                await dispararEmailSendGrid(calculo, email, zap);

                // 3. Envia link de acesso (Firebase Auth)
                await auth.sendSignInLinkToEmail(email, {
                    url: window.location.origin + `/login.html?id=${encodeURIComponent(email)}`,
                    handleCodeInApp: true
                });

                alert("Proposta gerada! Verifique seu e-mail.");
                window.location.href = `login.html?email=${email}`;

            } catch (error) {
                alert("Erro: " + error.message);
                this.innerHTML = 'Gerar Proposta Instant√¢nea';
                this.disabled = false;
            }
        });

        // GOOGLE PLACES AUTOCOMPLETE
        window.initAutocomplete = function() {
            const autocomplete = new google.maps.places.Autocomplete(document.getElementById('endereco'), {
                componentRestrictions: { country: "br" },
                fields: ["geometry", "formatted_address"],
                types: ["address"]
            });
            autocomplete.addListener("place_changed", () => {
                const place = autocomplete.getPlace();
                if (place.geometry) {
                    document.getElementById('lat').value = place.geometry.location.lat();
                    document.getElementById('lng').value = place.geometry.location.lng();
                }
            });
        };
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBJ6SKOgB0TpR9d6XF1WmsRcHVQZG4tjrU&libraries=places&callback=initAutocomplete" async defer></script>
</body>
</html>
