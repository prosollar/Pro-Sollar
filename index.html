<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-Sollar | Intelig√™ncia Energ√©tica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700;800&display=swap');

        :root {
            --bg-deep: #0a1120;
            --accent-blue: #3b82f6;
            --accent-yellow: #facc15;
            --accent-green: #22c55e;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            color: white;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 10% 80%, rgba(250, 204, 21, 0.05) 0%, transparent 30%);
            background-attachment: fixed;
        }

        /* Glassmorphism Effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Card Glow Border */
        .card-glow { position: relative; }
        .card-glow::before {
            content: ""; position: absolute; inset: -1px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.5), transparent, rgba(250, 204, 21, 0.5));
            border-radius: 2.5rem; z-index: -1; opacity: 0.4;
        }

        /* Inputs Premium UI */
        .input-dark {
            background: rgba(0, 0, 0, 0.4) !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
            box-shadow: inset 2px 2px 10px rgba(0, 0, 0, 0.5);
            color: #fff !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .input-dark:focus {
            border-color: rgba(255, 255, 255, 0.2) !important;
            background: rgba(0, 0, 0, 0.6) !important;
            outline: none;
        }

        .btn-yellow {
            background: linear-gradient(135deg, #facc15 0%, #eab308 100%);
            color: #000;
            font-weight: 800;
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-yellow:hover { 
            transform: scale(1.02); 
            box-shadow: 0 0 35px rgba(250, 204, 21, 0.6); 
        }

        /* Google Autocomplete Styles */
        .pac-container {
            background-color: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            border-radius: 1.25rem !important;
            margin-top: 10px !important;
            font-family: inherit !important;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5) !important;
        }
        .pac-item { color: #cbd5e1 !important; border-top: 1px solid rgba(255, 255, 255, 0.05) !important; padding: 12px !important; cursor: pointer; }
        .pac-item-query { color: white !important; font-weight: bold !important; }
        .pac-item:hover { background-color: #334155 !important; }

        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="overflow-x-hidden">

    <nav class="container mx-auto p-8 flex justify-between items-center relative z-10">
        <div class="flex items-center space-x-3">
            <div class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
                <i class="fas fa-solar-panel text-white text-2xl"></i>
            </div>
            <span class="text-2xl font-black tracking-tighter uppercase">Pro-<span class="text-blue-500">Sollar</span></span>
        </div>
        <button class="bg-blue-600/20 border border-blue-500/30 px-6 py-2 rounded-full text-sm font-bold hover:bg-blue-600 transition">
            Acesso Parceiro
        </button>
    </nav>

    <main class="container mx-auto px-6 py-12 lg:py-16 grid lg:grid-cols-2 gap-16 items-center">
        <div class="space-y-8">
            <div class="inline-block px-4 py-1 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-400 text-[10px] font-bold tracking-[0.3em] uppercase">
                Satellite Intelligence
            </div>
            <h1 class="text-6xl lg:text-7xl font-extrabold leading-[1.1]">
                Economia que vem do <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">C√©u.</span>
            </h1>
            <p class="text-slate-400 text-xl leading-relaxed max-w-lg">
                Usamos vis√£o computacional para analisar seu telhado e entregar sua independ√™ncia energ√©tica em 30 segundos.
            </p>
            <div class="flex gap-8 text-xs font-bold uppercase tracking-widest text-slate-500">
                <div class="flex items-center space-x-2"><i class="fas fa-microchip text-blue-500"></i> <span>AI Solar</span></div>
                <div class="flex items-center space-x-2"><i class="fas fa-globe-americas text-blue-500"></i> <span>GeoData</span></div>
            </div>
        </div>

        <div class="card-glow">
            <div class="glass-card p-10 space-y-8">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold tracking-tight text-white">Simule Seu Potencial</h2>
                    <i class="fas fa-bolt text-yellow-400 animate-pulse"></i>
                </div>

                <form id="simuladorForm" class="space-y-5">
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] ml-1">Local da Instala√ß√£o</label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-blue-500/70 group-focus-within:text-blue-400 transition-colors">
                                <i class="fas fa-satellite-dish"></i>
                            </div>
                            <input type="text" id="endereco" placeholder="Digite seu endere√ßo..." 
                            class="input-dark w-full pl-11 pr-4 py-4 rounded-2xl text-sm">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] ml-1">Gasto Mensal M√©dio</label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-yellow-500/70 group-focus-within:text-yellow-400 transition-colors">
                                <i class="fas fa-coins text-sm"></i>
                            </div>
                            <input type="number" id="consumo" placeholder="Ex: 450.00" 
                            class="input-dark w-full pl-11 pr-4 py-4 rounded-2xl text-sm">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] ml-1">Seu E-mail</label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-purple-500/70 group-focus-within:text-purple-400 transition-colors">
                                <i class="fas fa-envelope text-lg"></i>
                            </div>
                            <input type="email" id="email" placeholder="nome@email.com" 
                            class="input-dark w-full pl-11 pr-4 py-4 rounded-2xl text-sm">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] ml-1">Seu WhatsApp</label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-green-500/70 group-focus-within:text-green-400 transition-colors">
                                <i class="fab fa-whatsapp text-lg"></i>
                            </div>
                            <input type="tel" id="whatsapp" placeholder="(00) 00000-0000" 
                            class="input-dark w-full pl-11 pr-4 py-4 rounded-2xl text-sm">
                        </div>
                    </div>

                    <input type="hidden" id="lat"> <input type="hidden" id="lng">

                    <button type="button" id="btnGerar" class="btn-yellow w-full py-5 rounded-2xl uppercase tracking-[0.3em] text-[11px] font-black flex items-center justify-center mt-2">
                        Gerar Proposta Instant√¢nea <i class="fas fa-chevron-right ml-2 text-[10px]"></i>
                    </button>
                </form>
            </div>
        </div>
    </main>

    <section class="container mx-auto px-6 py-20 reveal">
        <div class="grid md:grid-cols-3 gap-8 text-center">
            <div class="glass-card p-10 border-blue-500/10">
                <i class="fas fa-satellite text-3xl text-blue-500 mb-6"></i>
                <h3 class="text-lg font-bold mb-3">An√°lise Geoespacial</h3>
                <p class="text-slate-400 text-sm">Mapeamento milim√©trico via sat√©lite para maior efici√™ncia.</p>
            </div>
            <div class="glass-card p-10 border-yellow-500/10">
                <i class="fas fa-sun text-3xl text-yellow-500 mb-6"></i>
                <h3 class="text-lg font-bold mb-3">Energia Limpa</h3>
                <p class="text-slate-400 text-sm">Aproveitamento total da incid√™ncia solar da sua regi√£o.</p>
            </div>
            <div class="glass-card p-10 border-green-500/10">
                <i class="fas fa-wallet text-3xl text-green-500 mb-6"></i>
                <h3 class="text-lg font-bold mb-3">Economia Imediata</h3>
                <p class="text-slate-400 text-sm">Redu√ß√£o de at√© 95% no custo da sua energia el√©trica.</p>
            </div>
        </div>
    </section>

    <footer class="container mx-auto px-6 py-12 text-center text-slate-600 border-t border-white/5">
        <p class="text-[10px] font-bold tracking-[0.4em] uppercase">¬© 2026 Pro-Sollar ‚Ä¢ Powered by Google Solar API</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>

    <script>
        // 2. Configura√ß√£o do Projeto
        const firebaseConfig = {
            apiKey: "AIzaSyCpcQqXdDWtEW2wPsj9Z2dLdt_IzLLKWV8",
            authDomain: "pro-sollar-performance.firebaseapp.com",
            projectId: "pro-sollar-performance",
            storageBucket: "pro-sollar-performance.firebasestorage.app",
            messagingSenderId: "484051034820",
            appId: "1:484051034820:web:3cf21ee3ce55b9c5625f91"
        };

        // 3. Inicializa√ß√£o Segura (Verifica se J√Å existe antes de criar)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
            console.log("üî• Firebase conectado (Modo Compat).");
        } else {
            console.log("‚ôªÔ∏è Firebase j√° estava ativo.");
        }

        // Inicializa os servi√ßos
        const db = firebase.firestore();
        const auth = firebase.auth();

        // 4. L√≥gica do Bot√£o
        const btn = document.getElementById('btnGerar');

        if (btn) {
            // Clona o bot√£o para limpar eventos antigos e garantir clique limpo
            const novoBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(novoBtn, btn);

            novoBtn.addEventListener('click', async function(e) {
                // Previne qualquer comportamento padr√£o
                e.preventDefault();
                
                const btnAtual = e.target.closest('button');
                const originalHTML = btnAtual.innerHTML;

                // Captura os dados com seguran√ßa
                const getVal = (id) => document.getElementById(id) ? document.getElementById(id).value : "";
                
                const email = getVal('email');
                const whatsappInput = getVal('whatsapp');
                const endereco = getVal('endereco');
                const consumo = getVal('consumo');
                const lat = getVal('lat');
                const lng = getVal('lng');
                const idLead = whatsappInput.replace(/\D/g, "");

                // Valida√ß√µes
                if (!email || !whatsappInput || !endereco || !consumo) {
                    alert("Por favor, preencha todos os campos.");
                    return;
                }
                if (!lat || !lng) {
                    alert("Por favor, selecione o endere√ßo na lista do Google Maps.");
                    return;
                }

                // Feedback Visual
                btnAtual.innerHTML = '<i class="fas fa-satellite-dish animate-pulse mr-2"></i> Enviando...';
                btnAtual.disabled = true;

                try {
                    // Refer√™ncia ao documento
                    const docRef = db.collection("leads").doc(idLead);
                    const docSnap = await docRef.get();

                    const actionCodeSettings = {
                        url: window.location.origin + `/login.html?id=${idLead}&verifying=true`,
                        handleCodeInApp: true
                    };

                    // Salva no Firestore
                    await docRef.set({
                        email: email,
                        whatsapp: idLead,
                        whatsapp_formatted: whatsappInput,
                        endereco: endereco,
                        consumo: parseFloat(consumo),
                        lat: parseFloat(lat),
                        lng: parseFloat(lng),
                        status: docSnap.exists ? "retorno" : "novo_lead",
                        atualizado_em: firebase.firestore.FieldValue.serverTimestamp(),
                        origem: "landing_page"
                    }, { merge: true });

                    console.log("Salvo no banco. Enviando e-mail...");

                    // Envia Link M√°gico
                    await auth.sendSignInLinkToEmail(email, actionCodeSettings);
                    
                    // Salva e-mail localmente para o login
                    window.localStorage.setItem('emailForSignIn', email);
                    
                    // Redireciona
                    window.location.href = `login.html?id=${idLead}&status=check_email&email=${email}`;

                } catch (error) {
                    console.error("Erro no processo:", error);
                    btnAtual.innerHTML = originalHTML;
                    btnAtual.disabled = false;

                    if (error.code === 'auth/unauthorized-domain') {
                        alert("ERRO DE DOM√çNIO: V√° no Firebase Console > Authentication > Settings e adicione o dom√≠nio da Vercel.");
                    } else {
                        alert("Erro: " + error.message);
                    }
                }
            });
        } else {
            console.error("ERRO: Bot√£o 'btnGerar' n√£o encontrado.");
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBJ6SKOgB0TpR9d6XF1WmsRcHVQZG4tjrU&libraries=places&callback=initAutocomplete" async defer></script>
</body>
</html>
